const _0x45c6c3=_0x4538;(function(_0x24a32a,_0x22bf57){const _0x1491a8=_0x4538,_0x208a7d=_0x24a32a();while(!![]){try{const _0xf8c731=-parseInt(_0x1491a8(0xb2))/0x1*(-parseInt(_0x1491a8(0xeb))/0x2)+parseInt(_0x1491a8(0xc3))/0x3+-parseInt(_0x1491a8(0x97))/0x4+-parseInt(_0x1491a8(0xa3))/0x5+-parseInt(_0x1491a8(0xa2))/0x6*(parseInt(_0x1491a8(0x9c))/0x7)+parseInt(_0x1491a8(0xdf))/0x8+-parseInt(_0x1491a8(0x99))/0x9;if(_0xf8c731===_0x22bf57)break;else _0x208a7d['push'](_0x208a7d['shift']());}catch(_0x18ab13){_0x208a7d['push'](_0x208a7d['shift']());}}}(_0x4b39,0x93b77));const newRandomArray=_0x3f18b8=>{const _0x148012=_0x4538,_0x1c6d28=Array[_0x148012(0xae)](_0x3f18b8);for(let _0x233fbe=_0x1c6d28['length']-0x1;_0x233fbe>=0x0;_0x233fbe--){const _0x4232c9=Math[_0x148012(0xde)](Math[_0x148012(0xdd)]()*(_0x233fbe+0x1));[_0x1c6d28[_0x233fbe],_0x1c6d28[_0x4232c9]]=[_0x1c6d28[_0x4232c9],_0x1c6d28[_0x233fbe]];}return _0x1c6d28;},nextRandomString=()=>{const _0x15cac0=_0x4538;return Math[_0x15cac0(0xdd)]()[_0x15cac0(0xb1)](0x24)[_0x15cac0(0xc5)](0x2)['padEnd'](0xb,'0');},getRandomStrings=_0x1642dd=>{const _0x9e8fe5=_0x4538,_0x35ce26=new Set();while(_0x35ce26[_0x9e8fe5(0xcf)]<_0x1642dd){_0x35ce26[_0x9e8fe5(0xe1)](nextRandomString());}return Array[_0x9e8fe5(0xae)](_0x35ce26);},getRandomRanged=(_0xe519b,_0x2b1b93)=>{const _0x3338f3=_0x4538;return Math[_0x3338f3(0xde)](_0xe519b+Math['random']()*(_0x2b1b93-_0xe519b));},getRankedArray=(_0x1428e2,_0x20aad9)=>{const _0x1ba5d0=_0x4538,_0x9f9aa5=_0x1428e2[_0x1ba5d0(0x8b)](_0xe8edb=>Object[_0x1ba5d0(0xa6)]({},_0xe8edb))['sort'](_0x20aad9);return _0x9f9aa5[_0x1ba5d0(0xce)]((_0x5e334d,_0x4eb192,_0x573fd8)=>{const _0x40babc=_0x1ba5d0;return!_0x5e334d?_0x4eb192[_0x40babc(0xda)]=0x1:_0x4eb192[_0x40babc(0xda)]=_0x20aad9(_0x4eb192,_0x5e334d)===0x0?_0x5e334d[_0x40babc(0xda)]:_0x573fd8+0x1,_0x4eb192;},null),_0x9f9aa5;},express=require('express'),app=express();app[_0x45c6c3(0xaf)](express[_0x45c6c3(0xb3)](_0x45c6c3(0xb9)));const http=require(_0x45c6c3(0x88))[_0x45c6c3(0xc1)](app);http[_0x45c6c3(0xb0)](process[_0x45c6c3(0xc2)]['PORT']||0xbb8);const io=require(_0x45c6c3(0x94))(http),rooms=((()=>{const _0x305169=new Map(),_0x4a3b46=_0x307857=>{return{'play':![],'game':{'actedDataMap':new Map(),'userPointsMap':new Map()},'ownerUserName':_0x307857,'members':new Set([_0x307857]),'getMemberList':function(){const _0x530344=_0x4538;return Array['from'](this[_0x530344(0xaa)]);}};};return{'getMemberList':_0x39274b=>{const _0x50f1fd=_0x4538;return _0x305169[_0x50f1fd(0xd8)](_0x39274b)?.[_0x50f1fd(0xbe)]()??[];},'joinMember':(_0x5996e6,_0x2f362d,_0x266593)=>{const _0x4c2a50=_0x4538;if(!_0x305169['has'](_0x5996e6)){const _0xbe55b4=_0x4a3b46(_0x2f362d);return _0x305169[_0x4c2a50(0x89)](_0x5996e6,_0xbe55b4),{'success':!![],'room':_0xbe55b4};}else{const _0x40d691=_0x305169[_0x4c2a50(0xd8)](_0x5996e6);if(_0x40d691[_0x4c2a50(0xb7)])return{'success':![],'reason':_0x4c2a50(0xcd)};if(_0x40d691[_0x4c2a50(0xaa)]['size']>=conf[_0x4c2a50(0x90)])return{'success':![],'reason':_0x4c2a50(0xbf)};return _0x40d691[_0x4c2a50(0xaa)]['has'](_0x2f362d)?{'success':![],'reason':_0x4c2a50(0xee)}:(_0x40d691[_0x4c2a50(0xaa)][_0x4c2a50(0xe1)](_0x2f362d),{'success':!![],'room':_0x40d691});}},'leaveMember':(_0xdab24e,_0x567b41)=>{const _0x13bcb8=_0x4538,_0xd93c63=_0x305169[_0x13bcb8(0xd8)](_0xdab24e);if(!_0xd93c63)return;const _0x36a963=_0xd93c63['members'];_0x36a963[_0x13bcb8(0xca)](_0x567b41),_0x36a963[_0x13bcb8(0xcf)]===0x0&&_0x305169[_0x13bcb8(0xca)](_0xdab24e),_0x567b41===_0xd93c63[_0x13bcb8(0x9a)]&&(_0xd93c63[_0x13bcb8(0x9a)]=_0x36a963['values']()[_0x13bcb8(0x8e)]()[_0x13bcb8(0xc7)]);}};})());let userNumber=0x0;function _0x4b39(){const _0x1cd51d=['use','listen','toString','276HQBgZv','static','wrong','disconnect','room_member_list','play','tag','public','slice','appId','currentTag','\x20...\x20','getMemberList','room_is_full','fastestUserName','Server','env','3577371LLivFi','userNameMaxLength','substring','click','value','length','minTakenTimeMS','delete','next_card','totalCount','playing_now','reduce','size','currentIndex','actedDataMap','start_play','success','memberCount','leave','userPointsMap','join','get','rankedUserResults','rank','takenTimeSec','reason','random','floor','9271752DPtfBD','readyCount','add','useCardCount','joinroom_invaid_parameter','leaveMember','card_phase_card_result','initialize','user_disconnect_in_game','joinMember','values','cardId','8252TIbIRH','takenTimeMS','userName','duplicated_usename','actionResults','to_waiting_room','progress:','currentCard','finish_play','http','set','ready_next_card','map','restCards','leave_room','next','game_end','maxUserInRoom','ready_play','emit','all_ready_next_card','socket.io','dataId','padEnd','4382328sZeQEa','joinroom_playing_now','10266642pYZOlS','ownerUserName','clear','4057991JtHrzr','game','all_ready_play','room','log','prepare_play','6TegSzv','345610LyGWHM','joinroom_room_is_full','correct','assign','roomName','./conf.json','ユーザ名は\x20','members','card_phase_update_actinfo','has','splice','from'];_0x4b39=function(){return _0x1cd51d;};return _0x4b39();}function _0x4538(_0x5b9319,_0x228bb3){const _0x4b398f=_0x4b39();return _0x4538=function(_0x4538e7,_0x28d4f1){_0x4538e7=_0x4538e7-0x83;let _0x5707d1=_0x4b398f[_0x4538e7];return _0x5707d1;},_0x4538(_0x5b9319,_0x228bb3);}const conf=require(_0x45c6c3(0xa8));io['sockets']['on']('connection',_0x4c4c1a=>{const _0x2b640c=_0x45c6c3,_0x4cc998={};let _0x162bb7;const _0x769620=_0x587154=>{const _0x3c2f47=_0x4538,_0x4e7b35=0x10;console[_0x3c2f47(0xa0)](_0x3c2f47(0x85)+_0x587154[_0x3c2f47(0x96)](_0x4e7b35)+_0x3c2f47(0xbd)+_0x4cc998[_0x3c2f47(0xa7)]+_0x3c2f47(0xbd),Array[_0x3c2f47(0xae)](_0x4cc998[_0x3c2f47(0x9f)][_0x3c2f47(0xaa)])[_0x3c2f47(0xd7)](','));};io['to'](_0x4c4c1a['id'])['emit'](_0x2b640c(0xe6),{'userNameMaxLength':conf[_0x2b640c(0xc4)],'userNumber':++userNumber});const _0x58bc26=_0x5a7a78=>{const _0x4866dd=_0x2b640c;return{'memberList':_0x5a7a78[_0x4866dd(0xbe)](),'ownerUserName':_0x5a7a78[_0x4866dd(0x9a)]};};_0x4c4c1a['on']('join_room',_0x290a35=>{const _0x88301f=_0x2b640c;if(_0x4cc998[_0x88301f(0xa7)])return;if(!_0x290a35[_0x88301f(0xbb)]||!_0x290a35[_0x88301f(0x95)]){_0x290a35[_0x88301f(0xdc)]='',io['to'](_0x4c4c1a['id'])['emit'](_0x88301f(0xe3),_0x290a35);return;}if(!_0x290a35['roomName']||!_0x290a35[_0x88301f(0xed)]){_0x290a35[_0x88301f(0xdc)]='部屋名・ユーザ名は\x201\x20文字以上必要です',io['to'](_0x4c4c1a['id'])[_0x88301f(0x92)](_0x88301f(0xe3),_0x290a35);return;}if(_0x290a35[_0x88301f(0xed)][_0x88301f(0xc8)]>conf['userNameMaxLength']){_0x290a35['reason']=_0x88301f(0xa9)+conf['userNameMaxLength']+'\x20文字以下にしてください',io['to'](_0x4c4c1a['id'])[_0x88301f(0x92)](_0x88301f(0xe3),_0x290a35);return;}const _0x273914=_0x290a35[_0x88301f(0xbb)]+'-'+_0x290a35[_0x88301f(0x95)]+'-'+_0x290a35[_0x88301f(0xa7)],_0x576485=rooms[_0x88301f(0xe8)](_0x273914,_0x290a35[_0x88301f(0xed)]);if(_0x576485[_0x88301f(0xd3)]){_0x4cc998[_0x88301f(0xed)]=_0x290a35[_0x88301f(0xed)],_0x4cc998['roomName']=_0x273914,_0x4c4c1a[_0x88301f(0xd7)](_0x4cc998[_0x88301f(0xa7)]),_0x4cc998[_0x88301f(0x9f)]=_0x576485[_0x88301f(0x9f)],_0x162bb7=_0x4cc998[_0x88301f(0x9f)][_0x88301f(0x9d)];const _0x9e7f4b=_0x4cc998[_0x88301f(0x9f)][_0x88301f(0xbe)]();io['to'](_0x4cc998['roomName'])['emit'](_0x88301f(0xb6),_0x58bc26(_0x4cc998[_0x88301f(0x9f)]));}else{if(_0x576485[_0x88301f(0xdc)]===_0x88301f(0xcd))io['to'](_0x4c4c1a['id'])['emit'](_0x88301f(0x98),_0x290a35);else{if(_0x576485[_0x88301f(0xdc)]===_0x88301f(0xee))io['to'](_0x4c4c1a['id'])[_0x88301f(0x92)]('joinroom_duplicated_usename',_0x290a35);else _0x576485['reason']===_0x88301f(0xbf)&&io['to'](_0x4c4c1a['id'])[_0x88301f(0x92)](_0x88301f(0xa4),_0x290a35);}}}),_0x4c4c1a['on'](_0x2b640c(0x8d),_0x289920=>{const _0x2b5fc4=_0x2b640c;if(!_0x4cc998[_0x2b5fc4(0xa7)])return;rooms['leaveMember'](_0x4cc998[_0x2b5fc4(0xa7)],_0x4cc998[_0x2b5fc4(0xed)]),_0x4c4c1a[_0x2b5fc4(0xd5)](_0x4cc998['roomName']),!_0x4cc998[_0x2b5fc4(0x9f)][_0x2b5fc4(0xb7)]?io['to'](_0x4cc998[_0x2b5fc4(0xa7)])[_0x2b5fc4(0x92)](_0x2b5fc4(0xb6),_0x58bc26(_0x4cc998['room'])):(_0x4cc998[_0x2b5fc4(0x9f)][_0x2b5fc4(0xb7)]=![],_0x769620(_0x2b5fc4(0x8d)),io['to'](_0x4cc998[_0x2b5fc4(0xa7)])[_0x2b5fc4(0x92)]('user_disconnect_in_game',Object[_0x2b5fc4(0xa6)]({'exitUserName':_0x4cc998['userName']},_0x58bc26(_0x4cc998[_0x2b5fc4(0x9f)])))),_0x4cc998[_0x2b5fc4(0xa7)]=null,_0x4cc998[_0x2b5fc4(0xed)]=null,_0x4cc998[_0x2b5fc4(0x9f)]=null,io['to'](_0x4c4c1a['id'])['emit']('leave_room_ok');}),_0x4c4c1a['on']('disconnect',()=>{const _0x2fe725=_0x2b640c;_0x4cc998[_0x2fe725(0xa7)]&&(!_0x4cc998[_0x2fe725(0x9f)][_0x2fe725(0xb7)]?(rooms[_0x2fe725(0xe4)](_0x4cc998[_0x2fe725(0xa7)],_0x4cc998[_0x2fe725(0xed)]),_0x4c4c1a['leave'](_0x4cc998[_0x2fe725(0xa7)]),io['to'](_0x4cc998['roomName'])[_0x2fe725(0x92)](_0x2fe725(0xb6),_0x58bc26(_0x4cc998['room']))):(_0x4cc998[_0x2fe725(0x9f)][_0x2fe725(0xb7)]=![],_0x769620(_0x2fe725(0xb5)),rooms['leaveMember'](_0x4cc998[_0x2fe725(0xa7)],_0x4cc998['userName']),_0x4c4c1a[_0x2fe725(0xd5)](_0x4cc998[_0x2fe725(0xa7)]),io['to'](_0x4cc998[_0x2fe725(0xa7)])[_0x2fe725(0x92)](_0x2fe725(0xe7),Object[_0x2fe725(0xa6)]({'exitUserName':_0x4cc998[_0x2fe725(0xed)]},_0x58bc26(_0x4cc998[_0x2fe725(0x9f)])))));}),_0x4c4c1a['on'](_0x2b640c(0x87),_0xd8b624=>{const _0x407287=_0x2b640c;_0x4cc998[_0x407287(0xed)]===_0x4cc998['room'][_0x407287(0x9a)]?(_0x4cc998['room'][_0x407287(0xb7)]=![],io['to'](_0x4cc998[_0x407287(0xa7)])[_0x407287(0x92)](_0x407287(0x84),_0x58bc26(_0x4cc998[_0x407287(0x9f)]))):io['to'](_0x4c4c1a['id'])[_0x407287(0x92)](_0x407287(0x84),_0x58bc26(_0x4cc998[_0x407287(0x9f)]));}),_0x4c4c1a['on'](_0x2b640c(0xd2),_0x572789=>{const _0x9a73ca=_0x2b640c;if(_0x4cc998['userName']===_0x4cc998[_0x9a73ca(0x9f)]['ownerUserName']){_0x769620('start_play'),_0x4cc998[_0x9a73ca(0x9f)][_0x9a73ca(0xb7)]=!![],_0x162bb7['readyCount']=0x0,_0x162bb7['memberCount']=_0x4cc998[_0x9a73ca(0x9f)]['members'][_0x9a73ca(0xcf)];const _0x884d12=_0x572789['cards'],_0x10d12a=getRandomStrings(_0x884d12['length']);_0x884d12['forEach']((_0x41a4ba,_0x4c317e)=>_0x41a4ba[_0x9a73ca(0xb8)]=_0x10d12a[_0x4c317e]),_0x162bb7['restCards']=newRandomArray(_0x884d12)[_0x9a73ca(0xba)](0x0,_0x572789[_0x9a73ca(0xe2)]);const _0xadb437=_0x162bb7['restCards'][_0x9a73ca(0x8b)](_0x5f36b2=>_0x5f36b2[_0x9a73ca(0xb8)]);_0x162bb7[_0x9a73ca(0xcc)]=_0x162bb7[_0x9a73ca(0x8c)][_0x9a73ca(0xc8)],_0x162bb7[_0x9a73ca(0xd6)][_0x9a73ca(0x9b)](),_0x4cc998['room']['members']['forEach'](_0x325f50=>{const _0x40db79=_0x9a73ca;_0x162bb7[_0x40db79(0xd6)][_0x40db79(0x89)](_0x325f50,{'userName':_0x325f50,'correct':0x0,'wrong':0x0});}),io['to'](_0x4cc998[_0x9a73ca(0xa7)])['emit'](_0x9a73ca(0xa1),{'tagSeq':_0x10d12a,'displaySeq':_0xadb437,'showData':_0x5d961d()});}}),_0x4c4c1a['on'](_0x2b640c(0x91),()=>{const _0x30cfae=_0x2b640c;++_0x162bb7['readyCount']===_0x4cc998[_0x30cfae(0x9f)][_0x30cfae(0xaa)][_0x30cfae(0xcf)]&&(_0x162bb7[_0x30cfae(0xe0)]=0x0,io['to'](_0x4cc998[_0x30cfae(0xa7)])[_0x30cfae(0x92)](_0x30cfae(0x9e)));}),_0x4c4c1a['on'](_0x2b640c(0x8a),()=>{const _0x4f51c9=_0x2b640c;++_0x162bb7[_0x4f51c9(0xe0)]===_0x4cc998[_0x4f51c9(0x9f)]['members']['size']&&(io['to'](_0x4cc998[_0x4f51c9(0xa7)])[_0x4f51c9(0x92)](_0x4f51c9(0x93)),_0x1b1de0());});const _0x5d961d=(_0x1ec413=![])=>{const _0x1eec9c=_0x2b640c,_0x344c2a=Array[_0x1eec9c(0xae)](_0x162bb7['userPointsMap'][_0x1eec9c(0xe9)]()),_0x4ecd4b={'count':{'total':_0x162bb7[_0x1eec9c(0xcc)],'rest':_0x162bb7['restCards']['length']},'userResults':_0x344c2a[_0x1eec9c(0x8b)](_0x1d968b=>Object['assign']({},_0x1d968b))};return _0x1ec413&&(_0x4ecd4b[_0x1eec9c(0xd9)]=getRankedArray(_0x344c2a,(_0x3d4e6d,_0x1b8e39)=>_0x3d4e6d[_0x1eec9c(0xa5)]!==_0x1b8e39['correct']?-_0x3d4e6d[_0x1eec9c(0xa5)]+_0x1b8e39[_0x1eec9c(0xa5)]:_0x3d4e6d[_0x1eec9c(0xb4)]-_0x1b8e39['wrong'])),_0x4ecd4b;},_0x1b1de0=()=>{const _0x30f634=_0x2b640c;if(_0x162bb7[_0x30f634(0x8c)]['length']<=0x1){io['to'](_0x4cc998['roomName'])[_0x30f634(0x92)](_0x30f634(0x8f),_0x5d961d(!![])),_0x769620('game_end');return;}_0x162bb7[_0x30f634(0xd0)]=getRandomRanged(0x0,_0x162bb7[_0x30f634(0x8c)]['length']),_0x162bb7[_0x30f634(0x86)]=_0x162bb7[_0x30f634(0x8c)][_0x162bb7[_0x30f634(0xd0)]],_0x162bb7[_0x30f634(0xbc)]=_0x162bb7['currentCard'][_0x30f634(0xb8)],_0x162bb7['actedDataMap'][_0x30f634(0x9b)](),_0x162bb7[_0x30f634(0xc9)]=Number['MAX_VALUE'],_0x162bb7['fastestUserName']=null,io['to'](_0x4cc998[_0x30f634(0xa7)])[_0x30f634(0x92)](_0x30f634(0xcb),{'currentTag':_0x162bb7['currentCard'][_0x30f634(0xb8)]});};_0x4c4c1a['on']('card_phase_acted',_0x3d2582=>{const _0x2143c8=_0x2b640c;if(_0x162bb7[_0x2143c8(0xbc)]!==_0x3d2582[_0x2143c8(0xbc)])return;if(_0x3d2582[_0x2143c8(0xed)]!==_0x4cc998[_0x2143c8(0xed)])return;if(_0x162bb7[_0x2143c8(0xd1)][_0x2143c8(0xac)](_0x4cc998[_0x2143c8(0xed)]))return;_0x162bb7[_0x2143c8(0xd1)][_0x2143c8(0x89)](_0x4cc998[_0x2143c8(0xed)],_0x3d2582),_0x3d2582['action']===_0x2143c8(0xc6)&&_0x3d2582[_0x2143c8(0xa5)]&&_0x3d2582[_0x2143c8(0xea)]===_0x162bb7[_0x2143c8(0x86)]['id']&&(_0x3d2582['takenTimeMS']<_0x162bb7[_0x2143c8(0xc9)]&&(_0x162bb7[_0x2143c8(0xc0)]=_0x4cc998['userName'],_0x162bb7[_0x2143c8(0xc9)]=_0x3d2582[_0x2143c8(0xec)]),_0x3d2582[_0x2143c8(0xdb)]=(_0x3d2582[_0x2143c8(0xec)]/0x3e8)['toFixed'](0x2)),_0x162bb7['actedDataMap'][_0x2143c8(0xcf)]!==_0x162bb7[_0x2143c8(0xd4)]?_0x28c581():_0x4deaa5();});const _0x50bb43=()=>{return Array['from'](_0x162bb7['actedDataMap']['values']());},_0x28c581=()=>{const _0x581983=_0x2b640c;_0x162bb7[_0x581983(0xbc)]&&io['to'](_0x4cc998[_0x581983(0xa7)])['emit'](_0x581983(0xab),{'currentTag':_0x162bb7[_0x581983(0xbc)],'minTakenTimeMS':_0x162bb7['fastestUserName']?_0x162bb7[_0x581983(0xc9)]:null,'actionResults':_0x50bb43()});},_0x4deaa5=()=>{const _0x172d58=_0x2b640c;if(_0x162bb7[_0x172d58(0xbc)]){const _0x47faba=_0x162bb7[_0x172d58(0xbc)];_0x162bb7[_0x172d58(0xbc)]=null,_0x162bb7['readyCount']=0x0;_0x162bb7[_0x172d58(0xd1)][_0x172d58(0xac)](_0x162bb7['fastestUserName'])&&_0x162bb7[_0x172d58(0x8c)][_0x172d58(0xad)](_0x162bb7[_0x172d58(0xd0)],0x1);_0x162bb7['userPointsMap']['forEach'](_0x39d3a4=>{const _0x5f15c4=_0x172d58,_0xbc7315=_0x162bb7['actedDataMap'][_0x5f15c4(0xd8)](_0x39d3a4[_0x5f15c4(0xed)]);if(_0xbc7315['userName']===_0x162bb7[_0x5f15c4(0xc0)])_0x39d3a4[_0x5f15c4(0xa5)]++;else _0xbc7315[_0x5f15c4(0xa5)]===![]&&_0x39d3a4['wrong']++;});const _0x291b27=Object[_0x172d58(0xa6)]({'card':{'currentTag':_0x47faba,'cardId':_0x162bb7['currentCard']['id'],'winnerUserName':_0x162bb7[_0x172d58(0xc0)]}},_0x5d961d());_0x291b27[_0x172d58(0x83)]=_0x50bb43(),io['to'](_0x4cc998[_0x172d58(0xa7)])[_0x172d58(0x92)](_0x172d58(0xe5),_0x291b27);}};});