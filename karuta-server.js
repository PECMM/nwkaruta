const _0x316cd4=_0x21d4;function _0x561d(){const _0xfdaff5=['cardId','readyCount','members','maxUserInRoom','\x20...\x20','random','leave','size','substring','map','floor','game_end','leave_room_ok','minTakenTimeMS','room_is_full','sort','joinroom_playing_now','userPointsMap','click','start_play','express','4382320FIcNcr','padEnd','currentCard','roomName','Server','card_phase_acted','finish_play','memberCount','sockets','userNameMaxLength','length','currentTag','log','MAX_VALUE','userName','static','playing_now','585756yIMLUS','leaveMember','reason','card_phase_card_result','emit','leave_room','to_waiting_room','join_room','prepare_play','restCards','has','disconnect','correct','dataId','ユーザ名は\x20','join','values','joinroom_invaid_parameter','room','ready_play','ownerUserName','card_phase_update_actinfo','actionResults','2454330wGYjNW','wrong','room_member_list','totalCount','987900cLMqTb','takenTimeSec','./conf.json','value','add','listen','http','rank','cards','forEach','3868320IGLbGn','delete','connection','play','get','fastestUserName','useCardCount','261190UkHDOp','set','\x20文字以下にしてください','from','assign','actedDataMap','takenTimeMS','appId','joinroom_room_is_full','joinroom_duplicated_usename','user_disconnect_in_game','all_ready_next_card','splice','PORT','18042178JXZHfo','ready_next_card','socket.io','tag','public','currentIndex','use','duplicated_usename','getMemberList','game'];_0x561d=function(){return _0xfdaff5;};return _0x561d();}(function(_0x2b96a1,_0x4279c8){const _0x2edaf6=_0x21d4,_0x5e0eaa=_0x2b96a1();while(!![]){try{const _0xa8932b=-parseInt(_0x2edaf6(0x218))/0x1+-parseInt(_0x2edaf6(0x1da))/0x2+-parseInt(_0x2edaf6(0x1c5))/0x3+-parseInt(_0x2edaf6(0x1c9))/0x4+-parseInt(_0x2edaf6(0x207))/0x5+parseInt(_0x2edaf6(0x1d3))/0x6+parseInt(_0x2edaf6(0x1e8))/0x7;if(_0xa8932b===_0x4279c8)break;else _0x5e0eaa['push'](_0x5e0eaa['shift']());}catch(_0x3b7956){_0x5e0eaa['push'](_0x5e0eaa['shift']());}}}(_0x561d,0x89c32));const newRandomArray=_0xe8437=>{const _0x4fe617=_0x21d4,_0x2713ff=Array[_0x4fe617(0x1dd)](_0xe8437);for(let _0x1c997f=_0x2713ff['length']-0x1;_0x1c997f>=0x0;_0x1c997f--){const _0x126bb7=Math[_0x4fe617(0x1fc)](Math[_0x4fe617(0x1f7)]()*(_0x1c997f+0x1));[_0x2713ff[_0x1c997f],_0x2713ff[_0x126bb7]]=[_0x2713ff[_0x126bb7],_0x2713ff[_0x1c997f]];}return _0x2713ff;},nextRandomString=()=>{const _0x5ef50e=_0x21d4;return Math[_0x5ef50e(0x1f7)]()['toString'](0x24)[_0x5ef50e(0x1fa)](0x2)[_0x5ef50e(0x208)](0xb,'0');},getRandomStrings=_0x2bfbae=>{const _0x20652e=_0x21d4,_0x30c208=new Set();while(_0x30c208[_0x20652e(0x1f9)]<_0x2bfbae){_0x30c208[_0x20652e(0x1cd)](nextRandomString());}return Array['from'](_0x30c208);},getRandomRanged=(_0x1164af,_0x2cc63c)=>{const _0x55033c=_0x21d4;return Math['floor'](_0x1164af+Math[_0x55033c(0x1f7)]()*(_0x2cc63c-_0x1164af));},getRankedArray=(_0x49393b,_0x305d3d)=>{const _0x567d22=_0x21d4,_0x4a9a10=_0x49393b[_0x567d22(0x1fb)](_0x4194c9=>Object[_0x567d22(0x1de)]({},_0x4194c9))[_0x567d22(0x201)](_0x305d3d);return _0x4a9a10['reduce']((_0x2ecf12,_0x31fe5a,_0x1d0aa7)=>{const _0x17a27e=_0x567d22;return!_0x2ecf12?_0x31fe5a['rank']=0x1:_0x31fe5a[_0x17a27e(0x1d0)]=_0x305d3d(_0x31fe5a,_0x2ecf12)===0x0?_0x2ecf12['rank']:_0x1d0aa7+0x1,_0x31fe5a;},null),_0x4a9a10;},express=require(_0x316cd4(0x206)),app=express();app[_0x316cd4(0x1ee)](express[_0x316cd4(0x216)](_0x316cd4(0x1ec)));const http=require(_0x316cd4(0x1cf))[_0x316cd4(0x20b)](app);http[_0x316cd4(0x1ce)](process['env'][_0x316cd4(0x1e7)]||0xbb8);function _0x21d4(_0x58a2cd,_0x217f85){const _0x561d2e=_0x561d();return _0x21d4=function(_0x21d486,_0x589454){_0x21d486=_0x21d486-0x1b3;let _0x15d993=_0x561d2e[_0x21d486];return _0x15d993;},_0x21d4(_0x58a2cd,_0x217f85);}const io=require(_0x316cd4(0x1ea))(http),rooms=((()=>{const _0x2147c1=new Map(),_0x5248c1=_0x1433a3=>{return{'play':![],'game':{'actedDataMap':new Map(),'userPointsMap':new Map()},'ownerUserName':_0x1433a3,'members':new Set([_0x1433a3]),'getMemberList':function(){const _0x598267=_0x21d4;return Array['from'](this[_0x598267(0x1f4)]);}};};return{'getMemberList':_0x181574=>{const _0x1f9ebe=_0x21d4;return _0x2147c1[_0x1f9ebe(0x1d7)](_0x181574)?.[_0x1f9ebe(0x1f0)]()??[];},'joinMember':(_0x1a37f1,_0x31798c,_0x504cae)=>{const _0x1d5739=_0x21d4;if(!_0x2147c1[_0x1d5739(0x1b8)](_0x1a37f1)){const _0x2b36eb=_0x5248c1(_0x31798c);return _0x2147c1['set'](_0x1a37f1,_0x2b36eb),{'success':!![],'room':_0x2b36eb};}else{const _0x49b66f=_0x2147c1[_0x1d5739(0x1d7)](_0x1a37f1);if(_0x49b66f['play'])return{'success':![],'reason':_0x1d5739(0x217)};if(_0x49b66f[_0x1d5739(0x1f4)][_0x1d5739(0x1f9)]>=conf[_0x1d5739(0x1f5)])return{'success':![],'reason':_0x1d5739(0x200)};return _0x49b66f[_0x1d5739(0x1f4)][_0x1d5739(0x1b8)](_0x31798c)?{'success':![],'reason':_0x1d5739(0x1ef)}:(_0x49b66f[_0x1d5739(0x1f4)][_0x1d5739(0x1cd)](_0x31798c),{'success':!![],'room':_0x49b66f});}},'leaveMember':(_0x839696,_0xa56a7b)=>{const _0xd92412=_0x21d4,_0x3ef80b=_0x2147c1['get'](_0x839696);if(!_0x3ef80b)return;const _0x2de016=_0x3ef80b[_0xd92412(0x1f4)];_0x2de016['delete'](_0xa56a7b),_0x2de016[_0xd92412(0x1f9)]===0x0&&_0x2147c1[_0xd92412(0x1d4)](_0x839696),_0xa56a7b===_0x3ef80b[_0xd92412(0x1c2)]&&(_0x3ef80b['ownerUserName']=_0x2de016[_0xd92412(0x1be)]()['next']()[_0xd92412(0x1cc)]);}};})());let userNumber=0x0;const conf=require(_0x316cd4(0x1cb));io[_0x316cd4(0x20f)]['on'](_0x316cd4(0x1d5),_0x574f0f=>{const _0x2fa92b=_0x316cd4,_0x3c5942={};let _0x5f5a31;const _0x39c8b3=_0x4bfb02=>{const _0x2bc3af=_0x21d4,_0x307ea2=0x10;console[_0x2bc3af(0x213)]('progress:'+_0x4bfb02[_0x2bc3af(0x208)](_0x307ea2)+'\x20...\x20'+_0x3c5942[_0x2bc3af(0x20a)]+_0x2bc3af(0x1f6),Array[_0x2bc3af(0x1dd)](_0x3c5942[_0x2bc3af(0x1c0)]['members'])[_0x2bc3af(0x1bd)](','));};io['to'](_0x574f0f['id'])[_0x2fa92b(0x21c)]('initialize',{'userNameMaxLength':conf['userNameMaxLength'],'userNumber':++userNumber});const _0x112ba7=_0x127ad9=>{return{'memberList':_0x127ad9['getMemberList'](),'ownerUserName':_0x127ad9['ownerUserName']};};_0x574f0f['on'](_0x2fa92b(0x1b5),_0x102a5d=>{const _0x20dfda=_0x2fa92b;if(_0x3c5942['roomName'])return;if(!_0x102a5d[_0x20dfda(0x1e1)]||!_0x102a5d[_0x20dfda(0x1bb)]){_0x102a5d[_0x20dfda(0x21a)]='',io['to'](_0x574f0f['id'])['emit'](_0x20dfda(0x1bf),_0x102a5d);return;}if(!_0x102a5d['roomName']||!_0x102a5d['userName']){_0x102a5d[_0x20dfda(0x21a)]='部屋名・ユーザ名は\x201\x20文字以上必要です',io['to'](_0x574f0f['id'])[_0x20dfda(0x21c)](_0x20dfda(0x1bf),_0x102a5d);return;}if(_0x102a5d['userName'][_0x20dfda(0x211)]>conf['userNameMaxLength']){_0x102a5d[_0x20dfda(0x21a)]=_0x20dfda(0x1bc)+conf[_0x20dfda(0x210)]+_0x20dfda(0x1dc),io['to'](_0x574f0f['id'])[_0x20dfda(0x21c)]('joinroom_invaid_parameter',_0x102a5d);return;}const _0x5b5010=_0x102a5d['appId']+'-'+_0x102a5d[_0x20dfda(0x1bb)]+'-'+_0x102a5d[_0x20dfda(0x20a)],_0x331e51=rooms['joinMember'](_0x5b5010,_0x102a5d['userName']);if(_0x331e51['success']){_0x3c5942[_0x20dfda(0x215)]=_0x102a5d[_0x20dfda(0x215)],_0x3c5942['roomName']=_0x5b5010,_0x574f0f[_0x20dfda(0x1bd)](_0x3c5942[_0x20dfda(0x20a)]),_0x3c5942[_0x20dfda(0x1c0)]=_0x331e51['room'],_0x5f5a31=_0x3c5942[_0x20dfda(0x1c0)][_0x20dfda(0x1f1)];const _0x3aae2a=_0x3c5942[_0x20dfda(0x1c0)][_0x20dfda(0x1f0)]();io['to'](_0x3c5942[_0x20dfda(0x20a)])[_0x20dfda(0x21c)]('room_member_list',_0x112ba7(_0x3c5942['room']));}else{if(_0x331e51[_0x20dfda(0x21a)]===_0x20dfda(0x217))io['to'](_0x574f0f['id'])[_0x20dfda(0x21c)](_0x20dfda(0x202),_0x102a5d);else{if(_0x331e51[_0x20dfda(0x21a)]==='duplicated_usename')io['to'](_0x574f0f['id'])[_0x20dfda(0x21c)](_0x20dfda(0x1e3),_0x102a5d);else _0x331e51[_0x20dfda(0x21a)]===_0x20dfda(0x200)&&io['to'](_0x574f0f['id'])[_0x20dfda(0x21c)](_0x20dfda(0x1e2),_0x102a5d);}}}),_0x574f0f['on'](_0x2fa92b(0x1b3),_0x50b7d0=>{const _0x158281=_0x2fa92b;if(!_0x3c5942['roomName'])return;rooms['leaveMember'](_0x3c5942['roomName'],_0x3c5942[_0x158281(0x215)]),_0x574f0f[_0x158281(0x1f8)](_0x3c5942[_0x158281(0x20a)]),!_0x3c5942['room']['play']?io['to'](_0x3c5942['roomName'])[_0x158281(0x21c)](_0x158281(0x1c7),_0x112ba7(_0x3c5942[_0x158281(0x1c0)])):(_0x3c5942[_0x158281(0x1c0)][_0x158281(0x1d6)]=![],_0x39c8b3('leave_room'),io['to'](_0x3c5942[_0x158281(0x20a)])[_0x158281(0x21c)](_0x158281(0x1e4),Object[_0x158281(0x1de)]({'exitUserName':_0x3c5942['userName']},_0x112ba7(_0x3c5942['room'])))),_0x3c5942['roomName']=null,_0x3c5942[_0x158281(0x215)]=null,_0x3c5942[_0x158281(0x1c0)]=null,io['to'](_0x574f0f['id'])['emit'](_0x158281(0x1fe));}),_0x574f0f['on'](_0x2fa92b(0x1b9),()=>{const _0x332300=_0x2fa92b;_0x3c5942['roomName']&&(!_0x3c5942[_0x332300(0x1c0)][_0x332300(0x1d6)]?(rooms['leaveMember'](_0x3c5942['roomName'],_0x3c5942['userName']),_0x574f0f['leave'](_0x3c5942[_0x332300(0x20a)]),io['to'](_0x3c5942[_0x332300(0x20a)])[_0x332300(0x21c)]('room_member_list',_0x112ba7(_0x3c5942[_0x332300(0x1c0)]))):(_0x3c5942[_0x332300(0x1c0)]['play']=![],_0x39c8b3(_0x332300(0x1b9)),rooms[_0x332300(0x219)](_0x3c5942['roomName'],_0x3c5942[_0x332300(0x215)]),_0x574f0f[_0x332300(0x1f8)](_0x3c5942[_0x332300(0x20a)]),io['to'](_0x3c5942[_0x332300(0x20a)])[_0x332300(0x21c)]('user_disconnect_in_game',Object[_0x332300(0x1de)]({'exitUserName':_0x3c5942['userName']},_0x112ba7(_0x3c5942[_0x332300(0x1c0)])))));}),_0x574f0f['on'](_0x2fa92b(0x20d),_0x637ae6=>{const _0x52f9b7=_0x2fa92b;_0x3c5942[_0x52f9b7(0x215)]===_0x3c5942['room'][_0x52f9b7(0x1c2)]?(_0x3c5942[_0x52f9b7(0x1c0)][_0x52f9b7(0x1d6)]=![],io['to'](_0x3c5942[_0x52f9b7(0x20a)])['emit'](_0x52f9b7(0x1b4),_0x112ba7(_0x3c5942[_0x52f9b7(0x1c0)]))):io['to'](_0x574f0f['id'])[_0x52f9b7(0x21c)](_0x52f9b7(0x1b4),_0x112ba7(_0x3c5942[_0x52f9b7(0x1c0)]));}),_0x574f0f['on']('start_play',_0x47bdf8=>{const _0x11e663=_0x2fa92b;if(_0x3c5942['userName']===_0x3c5942['room'][_0x11e663(0x1c2)]){_0x39c8b3(_0x11e663(0x205)),_0x3c5942[_0x11e663(0x1c0)]['play']=!![],_0x5f5a31['readyCount']=0x0,_0x5f5a31[_0x11e663(0x20e)]=_0x3c5942[_0x11e663(0x1c0)][_0x11e663(0x1f4)][_0x11e663(0x1f9)];const _0x562cdb=_0x47bdf8[_0x11e663(0x1d1)],_0x36df01=getRandomStrings(_0x562cdb['length']);_0x562cdb[_0x11e663(0x1d2)]((_0x3698f6,_0x3e15db)=>_0x3698f6[_0x11e663(0x1eb)]=_0x36df01[_0x3e15db]),_0x5f5a31[_0x11e663(0x1b7)]=newRandomArray(_0x562cdb)['slice'](0x0,_0x47bdf8[_0x11e663(0x1d9)]);const _0x1afda7=_0x5f5a31[_0x11e663(0x1b7)][_0x11e663(0x1fb)](_0x458cf3=>_0x458cf3['tag']);_0x5f5a31['totalCount']=_0x5f5a31['restCards'][_0x11e663(0x211)],_0x5f5a31[_0x11e663(0x203)]['clear'](),_0x3c5942[_0x11e663(0x1c0)][_0x11e663(0x1f4)][_0x11e663(0x1d2)](_0x6a6504=>{const _0x39edb4=_0x11e663;_0x5f5a31[_0x39edb4(0x203)][_0x39edb4(0x1db)](_0x6a6504,{'userName':_0x6a6504,'correct':0x0,'wrong':0x0});}),io['to'](_0x3c5942['roomName'])['emit'](_0x11e663(0x1b6),{'tagSeq':_0x36df01,'displaySeq':_0x1afda7,'showData':_0xa96929()});}}),_0x574f0f['on'](_0x2fa92b(0x1c1),()=>{const _0x4dc1ef=_0x2fa92b;++_0x5f5a31['readyCount']===_0x3c5942['room'][_0x4dc1ef(0x1f4)][_0x4dc1ef(0x1f9)]&&(_0x5f5a31[_0x4dc1ef(0x1f3)]=0x0,io['to'](_0x3c5942[_0x4dc1ef(0x20a)])[_0x4dc1ef(0x21c)]('all_ready_play'));}),_0x574f0f['on'](_0x2fa92b(0x1e9),()=>{const _0x4406c0=_0x2fa92b;++_0x5f5a31[_0x4406c0(0x1f3)]===_0x3c5942[_0x4406c0(0x1c0)][_0x4406c0(0x1f4)]['size']&&(io['to'](_0x3c5942[_0x4406c0(0x20a)])[_0x4406c0(0x21c)](_0x4406c0(0x1e5)),_0x1af130());});const _0xa96929=(_0x119456=![])=>{const _0x327f93=_0x2fa92b,_0x43a95f=Array[_0x327f93(0x1dd)](_0x5f5a31[_0x327f93(0x203)][_0x327f93(0x1be)]()),_0x1f4435={'count':{'total':_0x5f5a31[_0x327f93(0x1c8)],'rest':_0x5f5a31[_0x327f93(0x1b7)][_0x327f93(0x211)]},'userResults':_0x43a95f[_0x327f93(0x1fb)](_0x4db6b9=>Object[_0x327f93(0x1de)]({},_0x4db6b9))};return _0x119456&&(_0x1f4435['rankedUserResults']=getRankedArray(_0x43a95f,(_0x17b306,_0x172258)=>_0x17b306[_0x327f93(0x1ba)]!==_0x172258[_0x327f93(0x1ba)]?-_0x17b306[_0x327f93(0x1ba)]+_0x172258[_0x327f93(0x1ba)]:_0x17b306[_0x327f93(0x1c6)]-_0x172258[_0x327f93(0x1c6)])),_0x1f4435;},_0x1af130=()=>{const _0x277d34=_0x2fa92b;if(_0x5f5a31['restCards'][_0x277d34(0x211)]<=0x1){io['to'](_0x3c5942[_0x277d34(0x20a)])[_0x277d34(0x21c)](_0x277d34(0x1fd),_0xa96929(!![])),_0x39c8b3('game_end');return;}_0x5f5a31[_0x277d34(0x1ed)]=getRandomRanged(0x0,_0x5f5a31[_0x277d34(0x1b7)][_0x277d34(0x211)]),_0x5f5a31[_0x277d34(0x209)]=_0x5f5a31[_0x277d34(0x1b7)][_0x5f5a31[_0x277d34(0x1ed)]],_0x5f5a31[_0x277d34(0x212)]=_0x5f5a31[_0x277d34(0x209)][_0x277d34(0x1eb)],_0x5f5a31[_0x277d34(0x1df)]['clear'](),_0x5f5a31[_0x277d34(0x1ff)]=Number[_0x277d34(0x214)],_0x5f5a31[_0x277d34(0x1d8)]=null,io['to'](_0x3c5942['roomName'])[_0x277d34(0x21c)]('next_card',{'currentTag':_0x5f5a31[_0x277d34(0x209)][_0x277d34(0x1eb)]});};_0x574f0f['on'](_0x2fa92b(0x20c),_0x21fb78=>{const _0x5ef46b=_0x2fa92b;if(_0x5f5a31[_0x5ef46b(0x212)]!==_0x21fb78['currentTag'])return;if(_0x21fb78[_0x5ef46b(0x215)]!==_0x3c5942[_0x5ef46b(0x215)])return;if(_0x5f5a31['actedDataMap']['has'](_0x3c5942[_0x5ef46b(0x215)]))return;_0x5f5a31[_0x5ef46b(0x1df)]['set'](_0x3c5942['userName'],_0x21fb78),_0x21fb78['action']===_0x5ef46b(0x204)&&_0x21fb78['correct']&&_0x21fb78[_0x5ef46b(0x1f2)]===_0x5f5a31['currentCard']['id']&&(_0x21fb78[_0x5ef46b(0x1e0)]<_0x5f5a31[_0x5ef46b(0x1ff)]&&(_0x5f5a31['fastestUserName']=_0x3c5942[_0x5ef46b(0x215)],_0x5f5a31['minTakenTimeMS']=_0x21fb78[_0x5ef46b(0x1e0)]),_0x21fb78[_0x5ef46b(0x1ca)]=(_0x21fb78[_0x5ef46b(0x1e0)]/0x3e8)['toFixed'](0x2)),_0x5f5a31[_0x5ef46b(0x1df)][_0x5ef46b(0x1f9)]!==_0x5f5a31[_0x5ef46b(0x20e)]?_0x1690cc():_0x5208d2();});const _0x4042f8=()=>{const _0x467b0c=_0x2fa92b;return Array[_0x467b0c(0x1dd)](_0x5f5a31[_0x467b0c(0x1df)][_0x467b0c(0x1be)]());},_0x1690cc=()=>{const _0x35e87d=_0x2fa92b;_0x5f5a31[_0x35e87d(0x212)]&&io['to'](_0x3c5942['roomName'])[_0x35e87d(0x21c)](_0x35e87d(0x1c3),{'currentTag':_0x5f5a31['currentTag'],'minTakenTimeMS':_0x5f5a31[_0x35e87d(0x1d8)]?_0x5f5a31[_0x35e87d(0x1ff)]:null,'actionResults':_0x4042f8()});},_0x5208d2=()=>{const _0x1a1b31=_0x2fa92b;if(_0x5f5a31[_0x1a1b31(0x212)]){const _0x3c6251=_0x5f5a31['currentTag'];_0x5f5a31['currentTag']=null,_0x5f5a31[_0x1a1b31(0x1f3)]=0x0;_0x5f5a31[_0x1a1b31(0x1df)][_0x1a1b31(0x1b8)](_0x5f5a31[_0x1a1b31(0x1d8)])&&_0x5f5a31[_0x1a1b31(0x1b7)][_0x1a1b31(0x1e6)](_0x5f5a31[_0x1a1b31(0x1ed)],0x1);_0x5f5a31['userPointsMap'][_0x1a1b31(0x1d2)](_0x15100d=>{const _0x8eaba7=_0x1a1b31,_0x4a5e44=_0x5f5a31[_0x8eaba7(0x1df)][_0x8eaba7(0x1d7)](_0x15100d[_0x8eaba7(0x215)]);if(_0x4a5e44[_0x8eaba7(0x215)]===_0x5f5a31[_0x8eaba7(0x1d8)])_0x15100d[_0x8eaba7(0x1ba)]++;else _0x4a5e44['correct']===![]&&_0x15100d['wrong']++;});const _0x4e9786=Object[_0x1a1b31(0x1de)]({'card':{'currentTag':_0x3c6251,'cardId':_0x5f5a31['currentCard']['id'],'winnerUserName':_0x5f5a31['fastestUserName']}},_0xa96929());_0x4e9786[_0x1a1b31(0x1c4)]=_0x4042f8(),io['to'](_0x3c5942[_0x1a1b31(0x20a)])[_0x1a1b31(0x21c)](_0x1a1b31(0x21b),_0x4e9786);}};});